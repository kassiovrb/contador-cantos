<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contador de Cantos</title>

<style>
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    overflow: hidden;
    background: #f2f2f2;
    /* Ajuste exclusivo para iPhone */
body.ios #btnContar {
    height: 260px;      /* era 220px */
    font-size: 80px;    /* era 70px */
}

#app {
    width: 390px;
    height: 844px;
    transform-origin: top left;
    background: #f2f2f2;
    font-family: Arial, sans-serif;
    padding: 10px;
    box-sizing: border-box;
}

#topo {
    text-align: center;
}

#tempo {
    font-size: 60px;
    font-weight: bold;
}

#controleTempo {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 10px;
}

.btnTempo {
    font-size: 24px;
    padding: 5px 12px;
}

#previsao {
    margin-top: 10px;
    font-size: 20px;
    font-weight: bold;
}

#conteudo {
    margin-top: 20px;
}

#minutos {
    font-size: 14px;
    padding-right: 190px;
}

#contador {
    position: fixed;
    top: 180px;
    right: 25px;
    width: 170px;
    text-align: center;
    z-index: 10;
}

#labelCantos {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 6px;
}

#total {
    font-size: 72px;
    font-weight: bold;
    background: #FFD700;
    color: #000;
    width: 160px;
    height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    transition: background 0.1s ease;
}

.piscar {
    background: #FF3B3B !important;
}

#botoes {
    position: fixed;
    bottom: 130px;
    left: 0;
    width: 100%;
    text-align: center;
}

#btnContar {
    width: 110%;
    height: 110px;
    font-size: 70px;
    background: green;
    color: white;
    border: none;
    border-radius: 18px;
}

#btnsPequenos {
    margin-top: 10px;
}

.btnSmall {
    font-size: 16px;
    padding: 8px 14px;
    margin: 0 5px;
}
</style>
</head>

<body>
<div id="app">

<div id="topo">
    <div id="tempo">15:00</div>

    <div id="controleTempo">
        <button class="btnTempo" onclick="ajustarTempo(1)">â–²</button>
        <span id="tempoMin">15 min</span>
        <button class="btnTempo" onclick="ajustarTempo(-1)">â–¼</button>
    </div>

    <div id="previsao">PrevisÃ£o: 0 cantos</div>
</div>

<div id="conteudo">
    <div id="minutos"></div>
</div>

<div id="contador">
    <div id="labelCantos">CANTOS</div>
    <div id="total">0</div>
</div>

<div id="botoes">
    <button id="btnContar" onclick="contar()">CONTAR</button>

    <div id="btnsPequenos">
        <button class="btnSmall" onclick="pausar()">PAUSE</button>
        <button class="btnSmall" onclick="zerar()">ZERAR</button>
        <button class="btnSmall" onclick="toggleSom()" id="btnSom">Som: ON</button>
    </div>
</div>

</div>

<script>
function ajustarEscala() {
    const baseW = 390;
    const baseH = 844;

    const scaleX = window.innerWidth / baseW;
    const scaleY = window.innerHeight / baseH;
    let scale = Math.min(scaleX, scaleY);

    // Detecta iPhone / iOS
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

    // Se for iPhone, aumenta um pouco o tamanho geral
    if (isIOS) {
        scale *= 1.15; // ajuste fino: 1.08 a 1.18 conforme seu gosto
    }

    const app = document.getElementById("app");
    app.style.transform = `scale(${scale})`;
}

window.addEventListener("resize", ajustarEscala);
ajustarEscala();

let tempoTotal = 15 * 60;
let tempoRestante = tempoTotal;
let intervalo = null;
let previsaoIntervalo = null;

let totalCantos = 0;
let pausado = false;

let inicio = null;
let inicioMinuto = null;
let cantosMinutoAtual = 0;
let numeroMinuto = 0;

let somAtivo = true;
let audioCtx = null;

function tocarSom() {
    if (!somAtivo) return;
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "square";
    osc.frequency.value = 500;
    gain.gain.value = 0.1;

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start();
    setTimeout(() => osc.stop(), 50);
}

function toggleSom() {
    somAtivo = !somAtivo;
    document.getElementById("btnSom").innerText = somAtivo ? "Som: ON" : "Som: OFF";
}

function atualizarTela() {
    let min = Math.floor(tempoRestante / 60);
    let seg = tempoRestante % 60;
    document.getElementById("tempo").innerText =
        String(min).padStart(2, "0") + ":" + String(seg).padStart(2, "0");
}

function ajustarTempo(valor) {
    if (intervalo) return;
    let minutos = tempoTotal / 60 + valor;
    if (minutos < 1) return;
    tempoTotal = minutos * 60;
    tempoRestante = tempoTotal;
    document.getElementById("tempoMin").innerText = minutos + " min";
    atualizarTela();
}

function iniciarTimer() {
    inicio = Date.now();
    inicioMinuto = inicio;

    intervalo = setInterval(() => {
        if (!pausado) {
            tempoRestante--;
            atualizarTela();
            verificarMinuto();

            if (tempoRestante <= 0) {
                clearInterval(intervalo);
                clearInterval(previsaoIntervalo);
            }
        }
    }, 1000);

    previsaoIntervalo = setInterval(atualizarPrevisao, 5000);
}

function contar() {
    manterTelaAtiva();

    if (!intervalo) {
        iniciarTimer();
        return;
    }

    tocarSom();
    if (navigator.vibrate) navigator.vibrate(50);

    totalCantos++;
    cantosMinutoAtual++;

    const totalEl = document.getElementById("total");
    totalEl.innerText = totalCantos;
    totalEl.classList.add("piscar");
    setTimeout(() => totalEl.classList.remove("piscar"), 120);
}

function verificarMinuto() {
    let agora = Date.now();
    if (Math.floor((agora - inicioMinuto) / 60000) >= 1) {
        numeroMinuto++;
        document.getElementById("minutos").innerHTML +=
            `<div>${numeroMinuto}Âº minuto: ${cantosMinutoAtual} cantos</div>`;
        cantosMinutoAtual = 0;
        inicioMinuto = agora;
    }
}

function atualizarPrevisao() {
    if (!inicio) return;
    let tempoDecorrido = (Date.now() - inicio) / 1000;
    let previsao = Math.round((totalCantos / tempoDecorrido) * tempoTotal);
    document.getElementById("previsao").innerText =
        "PrevisÃ£o: " + previsao + " cantos";
}

function pausar() {
    pausado = !pausado;
}

function zerar() {
    clearInterval(intervalo);
    clearInterval(previsaoIntervalo);

    intervalo = null;
    previsaoIntervalo = null;

    tempoRestante = tempoTotal;
    totalCantos = 0;
    pausado = false;
    inicio = null;
    inicioMinuto = null;
    cantosMinutoAtual = 0;
    numeroMinuto = 0;

    document.getElementById("total").innerText = "0";
    document.getElementById("minutos").innerHTML = "";
    document.getElementById("previsao").innerText = "PrevisÃ£o: 0 cantos";

    atualizarTela();
}

atualizarTela();

/* ðŸ”’ Wake Lock */
let wakeLock = null;

async function manterTelaAtiva() {
    try {
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
        }
    } catch (err) {}
}

document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        manterTelaAtiva();
    }
});
    // Detecta iPhone / iOS e marca no body
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
if (isIOS) {
    document.body.classList.add("ios");
}
</script>

</body>
</html>







